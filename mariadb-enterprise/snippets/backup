- name: backup
  image: {{ .Values.mariadb.backup.image }}
  command:
    - flask
    - run
    - --host=0.0.0.0
    - --port=80
  imagePullPolicy: Always
  env:
  - name: CLUSTER_TOPOLOGY
    value: {{ .Values.mariadb.cluster.topology }}
  - name: FLASK_APP
    value: /python/backup/app.py
  volumeMounts:
  {{- if .Values.mariadb.backup.target.server }}
  - name: backup-data-storage
    mountPath: /backup-storage
  {{- end }}
  # a permanent volume for data storage
  - name: data
    mountPath: /var/lib/mysql
    subPath: mysql
  - name: mariadb-socket-vol
    mountPath: /var/run/mysqld
  - name: mariadb-secrets-vol
    mountPath: "/etc/hmac_secret"
    readOnly: true
