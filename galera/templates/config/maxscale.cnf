[maxscale]
threads=auto
substitute_variables=true

[Galera Monitor]
type=monitor
module=galeramon
servers=server1,server2,server3
user={{REPLICATION_USERNAME}}
passwd={{REPLICATION_PASSWORD}}
monitor_interval=10000
disable_master_failback=1

[qla]
type=filter
module=qlafilter
filebase=/tmp/SqlQueryLog

[fetch]
type=filter
module=regexfilter
match=fetch
replace=select

[RW]
type=service
router=readwritesplit
servers=server1,server2,server3
user={{REPLICATION_USERNAME}}
passwd={{REPLICATION_PASSWORD}}
max_slave_connections=100%
router_options=slave_selection_criteria=LEAST_CURRENT_OPERATIONS

[RR]
type=service
router=readconnroute
router_options=synced
servers=server1,server2,server3
user={{REPLICATION_USERNAME}}
passwd={{REPLICATION_PASSWORD}}

[MaxInfo]
type=service
router=maxinfo
user=monitor
passwd=monitor

[Debug Interface]
type=service
router=debugcli

[CLI]
type=service
router=cli

# Listener definitions for the services
# Listeners represent the ports the services will listen on.

[Read-Only-Listener]
type=listener
service=RR
protocol=mariadbclient
port=3307

[Read-Write-Listener]
type=listener
service=RW
protocol=mariadbclient
port=3308

[MaxInfo JSON Listener]
type=listener
service=MaxInfo
protocol=HTTPD
port=8003

[server1]
type=server
address={{APPLICATION}}-{{ENVIRONMENT}}-galera-0.{{APPLICATION}}-{{ENVIRONMENT}}-mariadb-galera
port=3306
protocol=mariadbbackend

[server2]
type=server
address={{APPLICATION}}-{{ENVIRONMENT}}-galera-1.{{APPLICATION}}-{{ENVIRONMENT}}-mariadb-galera
port=3306
protocol=mariadbbackend

[server3]
type=server
address={{APPLICATION}}-{{ENVIRONMENT}}-galera-2.{{APPLICATION}}-{{ENVIRONMENT}}-mariadb-galera
port=3306
protocol=mariadbbackend
